<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limepie PHP vs React Form Builder Comparison</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery (required for Limepie validate.js) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- js-yaml for parsing YAML -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

    <style>
        :root {
            --limepie-color: #777bb4;
            --react-color: #61dafb;
            --success-color: #28a745;
            --error-color: #dc3545;
        }

        body {
            background-color: #f8f9fa;
            padding: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 1.75rem;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #6c757d;
        }

        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .form-panel-header {
            padding: 15px 20px;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .limepie-panel .form-panel-header {
            background: var(--limepie-color);
            color: white;
        }

        .react-panel .form-panel-header {
            background: #282c34;
            color: var(--react-color);
        }

        .form-panel-body {
            padding: 20px;
        }

        /* Limepie form styling to match Bootstrap */
        .limepie-form .form-group {
            margin-bottom: 1rem;
        }

        .limepie-form .input-group-wrapper {
            position: relative;
        }

        .limepie-form .message {
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .limepie-form .form-check-input {
            width: 3rem;
            height: 1.5rem;
        }

        /* React form styling */
        .react-form .form-group {
            margin-bottom: 1rem;
        }

        .react-form .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Validation results panel */
        .validation-results {
            margin-top: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .validation-results h3 {
            font-size: 1.25rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .result-card {
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .result-card h4 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .result-card.match {
            border-color: var(--success-color);
            background: rgba(40, 167, 69, 0.05);
        }

        .result-card.mismatch {
            border-color: var(--error-color);
            background: rgba(220, 53, 69, 0.05);
        }

        .comparison-status {
            text-align: center;
            padding: 15px;
            border-radius: 6px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .comparison-status.identical {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .comparison-status.different {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }

        .error-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.875rem;
        }

        .error-list li {
            padding: 8px 10px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .error-list li strong {
            color: #495057;
        }

        .btn-validate {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            font-weight: 500;
        }

        .sync-indicator {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: auto;
        }

        .sync-indicator.synced {
            background: var(--success-color);
            color: white;
        }

        .sync-indicator.not-synced {
            background: #ffc107;
            color: #212529;
        }

        @media (max-width: 992px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="page-header">
            <h1>Limepie PHP vs React Form Builder Comparison</h1>
            <p>Compare validation results between the original Limepie PHP system and the new React form builder</p>
        </div>

        <div class="comparison-container">
            <!-- Limepie PHP Form (Left) -->
            <div class="form-panel limepie-panel">
                <div class="form-panel-header">
                    <span>Limepie PHP (Original)</span>
                    <span class="sync-indicator" id="limepie-sync">Original</span>
                </div>
                <div class="form-panel-body">
                    <form id="limepie-form" class="limepie-form" novalidate>
                        <!-- Name -->
                        <div class="form-group">
                            <label class="form-label">이름 <span class="text-danger">*</span></label>
                            <div class="input-group-wrapper">
                                <input type="text"
                                       class="form-control valid-target"
                                       name="name"
                                       data-rule-name="name"
                                       placeholder="이름을 입력하세요">
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label class="form-label">이메일 <span class="text-danger">*</span></label>
                            <div class="input-group-wrapper">
                                <input type="email"
                                       class="form-control valid-target"
                                       name="email"
                                       data-rule-name="email"
                                       placeholder="example@domain.com">
                            </div>
                        </div>

                        <!-- Phone -->
                        <div class="form-group">
                            <label class="form-label">전화번호</label>
                            <div class="input-group-wrapper">
                                <input type="text"
                                       class="form-control valid-target"
                                       name="phone"
                                       data-rule-name="phone"
                                       placeholder="010-1234-5678">
                            </div>
                            <small class="text-muted">선택사항입니다.</small>
                        </div>

                        <!-- Category -->
                        <div class="form-group">
                            <label class="form-label">문의 유형 <span class="text-danger">*</span></label>
                            <div class="input-group-wrapper">
                                <select class="form-select valid-target"
                                        name="category"
                                        data-rule-name="category">
                                    <option value="">선택하세요</option>
                                    <option value="general">일반 문의</option>
                                    <option value="support">기술 지원</option>
                                    <option value="sales">영업 문의</option>
                                </select>
                            </div>
                        </div>

                        <!-- Message -->
                        <div class="form-group">
                            <label class="form-label">문의 내용 <span class="text-danger">*</span></label>
                            <div class="input-group-wrapper">
                                <textarea class="form-control valid-target"
                                          name="message"
                                          data-rule-name="message"
                                          rows="5"
                                          placeholder="문의하실 내용을 자세히 적어주세요."></textarea>
                            </div>
                        </div>

                        <!-- Agree -->
                        <div class="form-group">
                            <div class="input-group-wrapper">
                                <div class="form-check form-switch">
                                    <input type="checkbox"
                                           class="form-check-input valid-target"
                                           name="agree"
                                           data-rule-name="agree"
                                           id="limepie-agree"
                                           value="1">
                                    <label class="form-check-label" for="limepie-agree">
                                        개인정보 수집 동의 <span class="text-danger">*</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button type="button" class="btn btn-primary btn-validate" onclick="validateLimepie()">
                            Limepie 검증 실행
                        </button>
                    </form>
                </div>
            </div>

            <!-- React Form Builder (Right) -->
            <div class="form-panel react-panel">
                <div class="form-panel-header">
                    <span>React Form Builder (New)</span>
                    <span class="sync-indicator" id="react-sync">React</span>
                </div>
                <div class="form-panel-body">
                    <div id="react-form-root"></div>
                </div>
            </div>
        </div>

        <!-- Validation Results -->
        <div class="validation-results">
            <h3>Validation Comparison Results</h3>

            <div class="comparison-status" id="comparison-status" style="display: none;">
                <!-- Status will be shown here -->
            </div>

            <div class="results-grid">
                <div class="result-card" id="limepie-results">
                    <h4>Limepie PHP Results</h4>
                    <ul class="error-list" id="limepie-error-list">
                        <li class="text-muted">Click "Limepie 검증 실행" to validate</li>
                    </ul>
                </div>

                <div class="result-card" id="react-results">
                    <h4>React Form Builder Results</h4>
                    <ul class="error-list" id="react-error-list">
                        <li class="text-muted">Click "React 검증 실행" to validate</li>
                    </ul>
                </div>

                <div class="result-card" id="diff-results">
                    <h4>Comparison</h4>
                    <div id="diff-content">
                        <p class="text-muted">Run both validations to compare</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Limepie validate.js -->
    <script src="js/dist.validate-1.0.26.js"></script>

    <script>
        // Form spec for validation
        const formSpec = {
            type: 'group',
            properties: {
                name: {
                    type: 'text',
                    rules: {
                        required: true,
                        minlength: 2,
                        maxlength: 50
                    },
                    messages: {
                        required: '이름을 입력해주세요.',
                        minlength: '이름은 최소 {0}자 이상이어야 합니다.',
                        maxlength: '이름은 {0}자를 초과할 수 없습니다.'
                    }
                },
                email: {
                    type: 'email',
                    rules: {
                        required: true,
                        email: true
                    },
                    messages: {
                        required: '이메일을 입력해주세요.',
                        email: '올바른 이메일 형식으로 입력해주세요.'
                    }
                },
                phone: {
                    type: 'text',
                    rules: {
                        match: '^$|^[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}$'
                    },
                    messages: {
                        match: '올바른 전화번호 형식으로 입력해주세요.'
                    }
                },
                category: {
                    type: 'select',
                    rules: {
                        required: true
                    },
                    messages: {
                        required: '문의 유형을 선택해주세요.'
                    }
                },
                message: {
                    type: 'textarea',
                    rules: {
                        required: true,
                        minlength: 10,
                        maxlength: 1000
                    },
                    messages: {
                        required: '문의 내용을 입력해주세요.',
                        minlength: '문의 내용은 최소 {0}자 이상이어야 합니다.',
                        maxlength: '문의 내용은 {0}자를 초과할 수 없습니다.'
                    }
                },
                agree: {
                    type: 'switcher',
                    rules: {
                        required: true
                    },
                    messages: {
                        required: '개인정보 수집에 동의해주세요.'
                    }
                }
            }
        };

        // Initialize Limepie validator
        let limepieValidator;

        $(function() {
            limepieValidator = $('#limepie-form').validate({
                spec: formSpec
            });
        });

        // Store validation results
        let limepieErrors = null;
        let reactErrors = null;

        // Validate Limepie form
        function validateLimepie() {
            const isValid = limepieValidator.loadvalid(true);

            // Collect errors from DOM
            limepieErrors = {};
            $('#limepie-form .message').each(function() {
                const wrapper = $(this).closest('.input-group-wrapper');
                const input = wrapper.find('.valid-target');
                const name = input.attr('name');
                if (name) {
                    limepieErrors[name] = $(this).text();
                }
            });

            displayLimepieResults(limepieErrors, isValid);
            compareResults();
        }

        function displayLimepieResults(errors, isValid) {
            const list = $('#limepie-error-list');
            list.empty();

            const errorKeys = Object.keys(errors);
            if (errorKeys.length === 0) {
                list.append('<li class="text-success">All fields are valid!</li>');
                $('#limepie-results').removeClass('mismatch').addClass('match');
            } else {
                errorKeys.forEach(field => {
                    list.append(`<li><strong>${field}:</strong> ${errors[field]}</li>`);
                });
                $('#limepie-results').removeClass('match');
            }
        }

        // This will be called from React
        window.setReactErrors = function(errors) {
            reactErrors = errors;
            displayReactResults(errors);
            compareResults();
        };

        function displayReactResults(errors) {
            const list = $('#react-error-list');
            list.empty();

            const errorKeys = Object.keys(errors);
            if (errorKeys.length === 0) {
                list.append('<li class="text-success">All fields are valid!</li>');
                $('#react-results').removeClass('mismatch').addClass('match');
            } else {
                errorKeys.forEach(field => {
                    list.append(`<li><strong>${field}:</strong> ${errors[field]}</li>`);
                });
                $('#react-results').removeClass('match');
            }
        }

        function compareResults() {
            if (limepieErrors === null || reactErrors === null) {
                return;
            }

            const statusEl = $('#comparison-status');
            const diffEl = $('#diff-content');

            // Compare errors
            const limepieKeys = Object.keys(limepieErrors).sort();
            const reactKeys = Object.keys(reactErrors).sort();

            let isIdentical = true;
            const differences = [];

            // Check if same fields have errors
            const allFields = [...new Set([...limepieKeys, ...reactKeys])];

            allFields.forEach(field => {
                const limepieMsg = limepieErrors[field];
                const reactMsg = reactErrors[field];

                if (limepieMsg && !reactMsg) {
                    isIdentical = false;
                    differences.push(`<li><strong>${field}:</strong> Only Limepie has error</li>`);
                } else if (!limepieMsg && reactMsg) {
                    isIdentical = false;
                    differences.push(`<li><strong>${field}:</strong> Only React has error</li>`);
                } else if (limepieMsg !== reactMsg) {
                    // Messages might differ slightly, check if both have errors
                    differences.push(`<li><strong>${field}:</strong> Both have errors (messages may differ)</li>`);
                }
            });

            statusEl.show();

            if (isIdentical || (limepieKeys.length === reactKeys.length && limepieKeys.every(k => reactKeys.includes(k)))) {
                statusEl.removeClass('different').addClass('identical');
                statusEl.html('<span style="font-size: 1.5rem;">&#10003;</span> Validation Results are IDENTICAL - Both systems detected the same validation errors');
                $('#diff-results').removeClass('mismatch').addClass('match');
            } else {
                statusEl.removeClass('identical').addClass('different');
                statusEl.html('<span style="font-size: 1.5rem;">&#9888;</span> Validation Results DIFFER - Systems detected different errors');
                $('#diff-results').removeClass('match').addClass('mismatch');
            }

            diffEl.empty();
            if (differences.length > 0) {
                diffEl.append(`<ul class="error-list">${differences.join('')}</ul>`);
            } else {
                diffEl.append('<p class="text-success">No differences found!</p>');
            }
        }

        // Sync form values between Limepie and React
        function syncFormsFromLimepie() {
            const data = {
                name: $('#limepie-form [name="name"]').val(),
                email: $('#limepie-form [name="email"]').val(),
                phone: $('#limepie-form [name="phone"]').val(),
                category: $('#limepie-form [name="category"]').val(),
                message: $('#limepie-form [name="message"]').val(),
                agree: $('#limepie-form [name="agree"]').is(':checked')
            };

            if (window.syncReactForm) {
                window.syncReactForm(data);
            }
        }

        // Add event listeners to sync forms
        $(function() {
            $('#limepie-form').on('input change', '.valid-target', function() {
                syncFormsFromLimepie();
            });
        });
    </script>

    <!-- React Form Builder -->
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Simple validation functions matching Limepie behavior
        const validators = {
            required: (value, param) => {
                if (param === false) return true;
                if (typeof value === 'boolean') return value === true;
                if (value === null || value === undefined) return false;
                return String(value).trim().length > 0;
            },

            minlength: (value, param) => {
                if (!value) return true; // Skip if empty (required handles that)
                return String(value).length >= param;
            },

            maxlength: (value, param) => {
                if (!value) return true;
                return String(value).length <= param;
            },

            email: (value, param) => {
                if (!value) return true;
                const emailRegex = /^[a-zA-Z0-9]+([._%-]?[a-zA-Z0-9]+)*(\+[a-zA-Z0-9]+)?@[a-zA-Z0-9]+([.-]?[a-zA-Z0-9]+)*\.[a-zA-Z]{2,}$/;
                return emailRegex.test(value);
            },

            match: (value, pattern) => {
                if (!value) return true;
                const regex = new RegExp(pattern);
                return regex.test(value);
            }
        };

        function formatMessage(message, param) {
            if (typeof message !== 'string') return message;
            return message.replace(/\{(\d+)\}/g, (match, index) => {
                if (Array.isArray(param)) {
                    return param[parseInt(index)] ?? match;
                }
                return param ?? match;
            });
        }

        function validateField(value, rules, messages) {
            for (const [rule, param] of Object.entries(rules)) {
                const validator = validators[rule];
                if (validator && !validator(value, param)) {
                    const message = messages?.[rule] || `Validation failed: ${rule}`;
                    return formatMessage(message, param);
                }
            }
            return null;
        }

        function ReactForm() {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                phone: '',
                category: '',
                message: '',
                agree: false
            });

            const [errors, setErrors] = useState({});

            // Expose sync function to window
            useEffect(() => {
                window.syncReactForm = (data) => {
                    setFormData(data);
                };
            }, []);

            // Sync to Limepie when React form changes
            const syncToLimepie = useCallback((data) => {
                $('#limepie-form [name="name"]').val(data.name);
                $('#limepie-form [name="email"]').val(data.email);
                $('#limepie-form [name="phone"]').val(data.phone);
                $('#limepie-form [name="category"]').val(data.category);
                $('#limepie-form [name="message"]').val(data.message);
                $('#limepie-form [name="agree"]').prop('checked', data.agree);
            }, []);

            const handleChange = (name, value) => {
                const newData = { ...formData, [name]: value };
                setFormData(newData);
                syncToLimepie(newData);
            };

            const validateAll = () => {
                const newErrors = {};
                const spec = formSpec.properties;

                for (const [field, fieldSpec] of Object.entries(spec)) {
                    if (fieldSpec.rules) {
                        const error = validateField(
                            formData[field],
                            fieldSpec.rules,
                            fieldSpec.messages
                        );
                        if (error) {
                            newErrors[field] = error;
                        }
                    }
                }

                setErrors(newErrors);
                window.setReactErrors(newErrors);
            };

            return (
                <form className="react-form" noValidate>
                    {/* Name */}
                    <div className="form-group">
                        <label className="form-label">이름 <span className="text-danger">*</span></label>
                        <input
                            type="text"
                            className={`form-control ${errors.name ? 'is-invalid' : ''}`}
                            value={formData.name}
                            onChange={(e) => handleChange('name', e.target.value)}
                            placeholder="이름을 입력하세요"
                        />
                        {errors.name && <div className="error-message">{errors.name}</div>}
                    </div>

                    {/* Email */}
                    <div className="form-group">
                        <label className="form-label">이메일 <span className="text-danger">*</span></label>
                        <input
                            type="email"
                            className={`form-control ${errors.email ? 'is-invalid' : ''}`}
                            value={formData.email}
                            onChange={(e) => handleChange('email', e.target.value)}
                            placeholder="example@domain.com"
                        />
                        {errors.email && <div className="error-message">{errors.email}</div>}
                    </div>

                    {/* Phone */}
                    <div className="form-group">
                        <label className="form-label">전화번호</label>
                        <input
                            type="text"
                            className={`form-control ${errors.phone ? 'is-invalid' : ''}`}
                            value={formData.phone}
                            onChange={(e) => handleChange('phone', e.target.value)}
                            placeholder="010-1234-5678"
                        />
                        <small className="text-muted">선택사항입니다.</small>
                        {errors.phone && <div className="error-message">{errors.phone}</div>}
                    </div>

                    {/* Category */}
                    <div className="form-group">
                        <label className="form-label">문의 유형 <span className="text-danger">*</span></label>
                        <select
                            className={`form-select ${errors.category ? 'is-invalid' : ''}`}
                            value={formData.category}
                            onChange={(e) => handleChange('category', e.target.value)}
                        >
                            <option value="">선택하세요</option>
                            <option value="general">일반 문의</option>
                            <option value="support">기술 지원</option>
                            <option value="sales">영업 문의</option>
                        </select>
                        {errors.category && <div className="error-message">{errors.category}</div>}
                    </div>

                    {/* Message */}
                    <div className="form-group">
                        <label className="form-label">문의 내용 <span className="text-danger">*</span></label>
                        <textarea
                            className={`form-control ${errors.message ? 'is-invalid' : ''}`}
                            value={formData.message}
                            onChange={(e) => handleChange('message', e.target.value)}
                            rows={5}
                            placeholder="문의하실 내용을 자세히 적어주세요."
                        />
                        {errors.message && <div className="error-message">{errors.message}</div>}
                    </div>

                    {/* Agree */}
                    <div className="form-group">
                        <div className="form-check form-switch">
                            <input
                                type="checkbox"
                                className="form-check-input"
                                checked={formData.agree}
                                onChange={(e) => handleChange('agree', e.target.checked)}
                                id="react-agree"
                            />
                            <label className="form-check-label" htmlFor="react-agree">
                                개인정보 수집 동의 <span className="text-danger">*</span>
                            </label>
                        </div>
                        {errors.agree && <div className="error-message">{errors.agree}</div>}
                    </div>

                    <button
                        type="button"
                        className="btn btn-info btn-validate text-white"
                        onClick={validateAll}
                    >
                        React 검증 실행
                    </button>
                </form>
            );
        }

        // Render React form
        const root = ReactDOM.createRoot(document.getElementById('react-form-root'));
        root.render(<ReactForm />);
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
